<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>–¢–∞–ø–∞–π —è–π—Ü–∞ –¥–æ–ª–±–∞–µ–±</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
* {
    box-sizing: border-box;
}
body {
    background: radial-gradient(circle at top, #3a0000 0%, #000 70%);
    color: #fff;
    font-family: 'Times New Roman', Roboto, sans-serif;
    text-align: center;
    margin: 0;
    padding: 15px 0 30px;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
    user-select: none;
}
/* ====== –°–¢–ê–¢–ò–°–¢–ò–ö–ê ====== */
.stats-container {
    margin-top: 15px;
    background: rgba(255, 0, 0, 0.12);
    padding: 16px 20px;
    border-radius: 22px;
    width: 90%;
    max-width: 420px;
    box-shadow: 0 0 25px rgba(255, 0, 0, 0.35);
}
.stats {
    font-size: 22px;
    font-weight: bold;
    text-shadow: 0 0 8px rgba(255, 60, 60, 0.9);
}
/* ====== –ù–ê–í–ò–ì–ê–¶–ò–Ø ====== */
.nav-tabs {
    display: flex;
    gap: 12px;
    justify-content: center;
    margin: 18px 0 10px;
    flex-wrap: wrap;
}
.tab-btn {
    padding: 10px 26px;
    border-radius: 14px;
    border: 1px solid #ff2a2a;
    background: linear-gradient(145deg, #1a0000, #2a0000);
    color: white;
    cursor: pointer;
    font-weight: bold;
    box-shadow: 0 0 12px rgba(255, 0, 0, 0.25);
    transition: 0.25s;
}
.tab-btn:hover {
    box-shadow: 0 0 18px rgba(255, 0, 0, 0.6);
}
.tab-btn.active {
    background: linear-gradient(145deg, #ff0000, #8b0000);
    box-shadow: 0 0 25px rgba(255, 0, 0, 0.9);
}
/* ====== –≠–ö–†–ê–ù–´ ====== */
.screen {
    display: none;
    width: 100%;
    max-width: 480px;
    align-items: center;
    flex-direction: column;
    padding-top: 10px;
}
.active-screen {
    display: flex;
}
/* ====== –Ø–ô–¶–û / –ë–û–°–° ====== */
#coin, #boss-img {
    width: 220px;
    height: 220px;
    border-radius: 50%;
    border: 4px solid #ff1e1e;
    box-shadow:
        0 0 25px #ff0000,
        0 0 45px rgba(255, 0, 0, 0.6);
    cursor: pointer;
    object-fit: cover;
    margin: 18px 0;
    transition: transform 0.15s;
}
#coin:active, #boss-img:active {
    transform: scale(0.95);
}
/* ====== –ö–ù–û–ü–ö–ò ====== */
.grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 14px;
    width: 92%;
    max-width: 420px;
    margin-top: 20px;
}
.neon-btn {
    background: linear-gradient(135deg, #ff0000, #7a0000);
    border: none;
    border-radius: 14px;
    color: white;
    padding: 14px 10px;
    font-weight: bold;
    cursor: pointer;
    text-shadow: 0 0 6px rgba(255, 255, 255, 0.5);
    box-shadow:
        0 0 15px rgba(255, 0, 0, 0.5),
        inset 0 0 10px rgba(255, 255, 255, 0.1);
    transition: 0.2s;
}
.neon-btn:hover {
    box-shadow: 0 0 25px rgba(255, 0, 0, 0.9);
}
/* ====== –ë–û–°–°–´ ====== */
.boss-card {
    background: rgba(70, 0, 0, 0.55);
    border-radius: 18px;
    padding: 16px;
    margin: 12px 0;
    width: 92%;
    max-width: 420px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    text-align: left;
    box-shadow: 0 0 20px rgba(255, 0, 0, 0.4);
}
.boss-info {
    text-shadow: 0 0 6px rgba(255, 80, 80, 0.6);
}
.boss-info small {
    display: block;
    opacity: 0.85;
    margin-top: 4px;
}
/* ====== HP ====== */
.hp-container {
    width: 85%;
    height: 26px;
    background: #1c0000;
    border-radius: 14px;
    overflow: hidden;
    margin: 12px 0;
    box-shadow: inset 0 0 8px rgba(255, 0, 0, 0.6);
}

#hp-bar {
    height: 100%;
    background: linear-gradient(90deg, #ff0000, #ff9a9a);
    box-shadow: 0 0 12px rgba(255, 0, 0, 0.8);
}
/* ====== –¢–ê–ô–ú–ï–† ====== */
#timer {
    font-size: 20px;
    margin-top: 10px;
    color: #ffb3b3;
    text-shadow: 0 0 10px rgba(255, 80, 80, 0.8);
}
</style>
</head>
<body>

<div class="stats-container">
    <div class="stats">–ù–∞—Ç—ã–∫–∞–ª(–∞) –ø–æ —è–π—Ü–∞–º: <span id="balance">0</span></div>
    <div class="stats">‚ö° –°–∏–ª–∞ –∫–ª–∏–∫–∞: <span id="clickLvl">1</span></div>

    <div class="nav-tabs">
        <button class="tab-btn active" onclick="showScreen('main', this)">–ì–õ–ê–í–ù–ê–Ø</button>
        <button class="tab-btn" onclick="showScreen('boss-list', this)">–ë–û–°–°–´</button>
        <button class="tab-btn" onclick="showScreen('gamble', this)">–ö–ê–ó–ò–ù–û</button>
    </div>
</div>

<!-- –≠–ö–†–ê–ù –ì–õ–ê–í–ù–ê–Ø -->
<div id="main" class="screen active-screen">
    <img id="coin" src="https://raw.githubusercontent.com/bmrzzmrb/TapikTap/main/andrey.png" onclick="clickCoin()">
    <div class="grid">
        <button class="neon-btn" onclick="upgradeClick()">
            ‚ûï –°–ò–õ–ê +1<br>
            <small>–¶–µ–Ω–∞: <span id="upgradeCost">10</span></small>
        </button>

        <button class="neon-btn" onclick="upgradeClickX2()">
            üí• –°–ò–õ–ê x2<br>
            <small>–¶–µ–Ω–∞: <span id="x2Cost">50000000</span></small>
        </button>

        <button class="neon-btn" onclick="saveGame()">üíæ –°–û–•–†–ê–ù–ò–¢–¨</button>
    </div>
</div>

<!-- –≠–ö–†–ê–ù –ê–ó–ê–†–¢ -->
<div id="gamble" class="screen">
    <h2>–ö–ê–ó–ò–ù–û</h2>
    <p>–í—ã–±–µ—Ä–∏ —Å—Ç–∞–≤–∫—É –∏ —Ü–≤–µ—Ç</p>

    <!-- –°–¢–ê–í–ö–ò -->
    <div class="grid">
        <button class="neon-btn" onclick="setBet(10000)">10.000</button>
        <button class="neon-btn" onclick="setBetPercent(25)">25%</button>
        <button class="neon-btn" onclick="setBetPercent(50)">50%</button>
        <button class="neon-btn" onclick="setAllIn()">ALL IN</button>
    </div>

    <p style="margin-top:15px;">
        –°—Ç–∞–≤–∫–∞: <b><span id="currentBet">0</span></b>
    </p>

    <!-- –¶–í–ï–¢–ê -->
    <div class="grid">
        <button class="neon-btn" style="background:#ff0000" onclick="playGamble('red')">üî¥</button>
        <button class="neon-btn" style="background:#00aa00" onclick="playGamble('green')">üü¢</button>
        <button class="neon-btn" style="background:#0000ff" onclick="playGamble('blue')">üîµ</button>
    </div>

    <p id="gambleResult" style="margin-top:15px;"></p>
</div>

<div id="boss-list" class="screen">
    <div class="boss-card">
        <div class="boss-info">
            <b>–•–æ–¥–∏–ª–∫–∞ –±—Ä–æ–¥–∏–ª–∫–∞</b>
            <small>HP: 20 000</small>
            <small>–í—Ö–æ–¥: 1 000</small>
            <small>–ù–∞–≥—Ä–∞–¥–∞: 15 000</small>
            <small>–ü–æ—è–≤–ª—è–µ—Ç—Å—è –≤–Ω–µ–∑–∞–ø–Ω–æ. –£—Ö–æ–¥–∏—Ç –±–µ–∑ –æ–±—ä—è—Å–Ω–µ–Ω–∏–π.</small>
        </div>
        <button class="neon-btn" onclick="startBossFight(
            '–•–æ–¥–∏–ª–∫–∞ –±—Ä–æ–¥–∏–ª–∫–∞',20000,15000,1000,
            'https://raw.githubusercontent.com/bmrzzmrb/TapikTap/main/hodilkabrodilka.jpg'
        )">–í –ë–û–ô</button>
    </div>
    <div class="boss-card">
        <div class="boss-info">
            <b>–ú–µ—Ä—Å–µ–¥–µ—Å</b>
            <small>HP: 600</small>
            <small>–í—Ö–æ–¥: 3 000</small>
            <small>–ù–∞–≥—Ä–∞–¥–∞: 15 000</small>
            <small>–£—á–∏—Ç–µ–ª—å-–∫–∞—Ä–∞—Ç–µ–ª—å. –ó–≤–æ–Ω–æ–∫ –¥–ª—è –Ω–µ—ë ‚Äî –Ω–µ –∑–∞–∫–æ–Ω.</small>
        </div>
        <button class="neon-btn" onclick="startBossFight(
            '–ú–µ—Ä—Å–µ–¥–µ—Å',600,15000,3000,
            'https://raw.githubusercontent.com/bmrzzmrb/TapikTap/main/mersedes.jpg'
        )">–í –ë–û–ô</button>
    </div>
    <div class="boss-card">
        <div class="boss-info">
            <b>–§–∏–∑–∏–∫</b>
            <small>HP: 1 200</small>
            <small>–í—Ö–æ–¥: 8 000</small>
            <small>–ù–∞–≥—Ä–∞–¥–∞: 30 000</small>
            <small>–ó–∞—Å—Ç–∞–≤–∏—Ç —Å—Ç—Ä–∞–¥–∞—Ç—å –¥–∞–∂–µ –æ—Ç–ª–∏—á–Ω–∏–∫–æ–≤.</small>
        </div>
        <button class="neon-btn" onclick="startBossFight(
            '–§–∏–∑–∏–∫',1200,30000,8000,
            'https://raw.githubusercontent.com/bmrzzmrb/TapikTap/main/fizik.jpg'
        )">–í –ë–û–ô</button>
    </div>
    <div class="boss-card">
        <div class="boss-info">
            <b>–ê–≥–∞–∞–∞–∞–∞–∞</b>
            <small>HP: 2 000</small>
            <small>–í—Ö–æ–¥: 5 000</small>
            <small>–ù–∞–≥—Ä–∞–¥–∞: 300 000 000</small>
            <small>–û—Ä —Å–ª—ã—à–µ–Ω –∑–∞ —Ç—Ä–∏ —Ä–∞–π–æ–Ω–∞.</small>
        </div>
        <button class="neon-btn" onclick="startBossFight(
            '–ê–≥–∞–∞–∞–∞–∞–∞',2000,300000000,5000,
            'https://raw.githubusercontent.com/bmrzzmrb/TapikTap/main/agaaa.jpg'
        )">–í –ë–û–ô</button>
    </div>
    <div class="boss-card">
        <div class="boss-info">
            <b>–ò–∏—Å—Ç–æ–æ–æ–æ—Ä–∏–∏–∏–∫</b>
            <small>HP: 25000</small>
            <small>–í—Ö–æ–¥: 30 000</small>
            <small>–ù–∞–≥—Ä–∞–¥–∞: 250 000</small>
            <small>–§–∞ –§–∞ –§–∞ —à–Ω–µ–π–Ω–µ –≤–∞—Ç–∞—Ñ–∞.</small>
        </div>
        <button class="neon-btn" onclick="startBossFight(
            '–ò–∏—Å—Ç–æ–æ–æ–æ—Ä–∏–∏–∏–∫',25000,250000,30000,
            'https://raw.githubusercontent.com/bmrzzmrb/TapikTap/main/istorik.jpg'
        )">–í –ë–û–ô</button>
    </div>
    <div class="boss-card">
        <div class="boss-info">
            <b>–ñ–∞–Ω–Ω–∞ –ö–∏—Å–∫–∞</b>
            <small>HP: 100000</small>
            <small>–í—Ö–æ–¥: 60 000</small>
            <small>–ù–∞–≥—Ä–∞–¥–∞: 500 000</small>
            <small>–ú–æ—Ä–∞–ª—å–Ω—ã–π —É—Ä–æ–Ω x10.</small>
        </div>
        <button class="neon-btn" onclick="startBossFight(
            '–ñ–∞–Ω–Ω–∞ –ö–∏—Å–∫–∞',100000,500000,60000,
            'https://raw.githubusercontent.com/bmrzzmrb/TapikTap/main/jannakiska.jpg'
        )">–í –ë–û–ô</button>
    </div>
    <div class="boss-card">
        <div class="boss-info">
            <b>–ú–æ—Ö-–ò—Ä–µ–≤–∞</b>
            <small>HP: 100 000</small>
            <small>–í—Ö–æ–¥: 120 000</small>
            <small>–ù–∞–≥—Ä–∞–¥–∞: 1 000 000</small>
            <small>–ë—å—ë—Ç —Å–ª–æ–≤–æ–º —Å–∏–ª—å–Ω–µ–µ –∫—É–ª–∞–∫–∞.</small>
        </div>
        <button class="neon-btn" onclick="startBossFight(
            '–ú–æ—Ö-–ò—Ä–µ–≤–∞',100000,1000000,120000,
            'https://raw.githubusercontent.com/bmrzzmrb/TapikTap/main/moxireva.jpg'
        )">–í –ë–û–ô</button>
    </div>
    <div class="boss-card">
        <div class="boss-info">
            <b>–î–∏–∫–∞—è —Ç—Ä–æ–∏—Ü–∞</b>
            <small>HP: 100 000</small>
            <small>–í—Ö–æ–¥: 250 000</small>
            <small>–ù–∞–≥—Ä–∞–¥–∞: 750 000</small>
            <small>–ë—å—é—Ç –≤—Ç—Ä–æ—ë–º. –î—É–º–∞—é—Ç –Ω–æ–ª—å —Å–µ–∫—É–Ω–¥.</small>
        </div>
        <button class="neon-btn" onclick="startBossFight(
            '–î–∏–∫–∞—è —Ç—Ä–æ–∏—Ü–∞',100000,750000,250000,
            'https://raw.githubusercontent.com/bmrzzmrb/TapikTap/main/troica.jpg'
        )">–í –ë–û–ô</button>
    </div>
    <div class="boss-card">
        <div class="boss-info">
            <b>–ú–∏—à—É–∫</b>
            <small>HP: 100 000</small>
            <small>–í—Ö–æ–¥: 500 000</small>
            <small>–ù–∞–≥—Ä–∞–¥–∞: 2 000 000</small>
            <small>–ü–æ–º–Ω–∏—Ç –æ—Ü–µ–Ω–∫–∏. –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∑–∞–±—ã–≤–∞–µ—Ç.</small>
        </div>
        <button class="neon-btn" onclick="startBossFight(
            '–ú–∏—à—É–∫',100000,2000000,500000,
            'https://raw.githubusercontent.com/bmrzzmrb/TapikTap/main/mishyk.jpg'
        )">–í –ë–û–ô</button>
    </div>
    <div class="boss-card">
        <div class="boss-info">
            <b>–®–ï–í–ê</b>
            <small>HP: 100 000</small>
            <small>–í—Ö–æ–¥: 500 000</small>
            <small>–ù–∞–≥—Ä–∞–¥–∞: 2 000 000</small>
            <small>–î–æ —Å–≤–∏–¥–∞–Ω–∏—è, –¥–æ–ª–±–∞–µ–±.</small>
        </div>
        <button class="neon-btn" onclick="startBossFight(
            '–®–ï–í–ê',100000,2000000,500000,
            'https://raw.githubusercontent.com/bmrzzmrb/TapikTap/main/sheva.jpg'
        )">–í –ë–û–ô</button>
    </div>
    <div class="boss-card">
        <div class="boss-info">
            <b>–ò–ì–û–†–¨</b>
            <small>HP: 100 000</small>
            <small>–í—Ö–æ–¥: 100 000</small>
            <small>–ù–∞–≥—Ä–∞–¥–∞: 1 000 000</small>
            <small>–•–æ—Ä–æ—à–∏–π —á–µ–ª–æ–≤–µ–∫.</small>
        </div>
        <button class="neon-btn" onclick="startBossFight(
            '–ò–ì–û–†–¨',100000,1000000,100000,
            'https://raw.githubusercontent.com/bmrzzmrb/TapikTap/main/igor.jpg'
        )">–í –ë–û–ô</button>
    </div>
    <div class="boss-card">
        <div class="boss-info">
            <b>–ê—Ä—Ç–µ–º–∏–π</b>
            <small>HP: 1 000 000</small>
            <small>–í—Ö–æ–¥: 100 000</small>
            <small>–ù–∞–≥—Ä–∞–¥–∞: 10 000 000</small>
            <small>–ö—Ä—É—Ç–æ–π –ø–∞—Ü–∞–Ω</small>
        </div>
        <button class="neon-btn" onclick="startBossFight(
            '–ê—Ä—Ç–µ–º–∏–π',1000000,10000000,100000,
            'https://raw.githubusercontent.com/bmrzzmrb/TapikTap/main/tema.jpg'
        )">–í –ë–û–ô</button>
    </div>
    <div class="boss-card">
        <div class="boss-info">
            <b>–î–µ–º–µ–Ω—Ç–∏–π</b>
            <small>HP: 100 000</small>
            <small>–í—Ö–æ–¥: 100 000</small>
            <small>–ù–∞–≥—Ä–∞–¥–∞: 1 000 000</small>
            <small>–õ—é–±–ª—é —Ç–µ–±—è –ø—É–ø—Å–∏–∫.</small>
        </div>
        <button class="neon-btn" onclick="startBossFight(
            '–î–µ–º–µ–Ω—Ç–∏–π',100000,1000000,100000,
            'https://raw.githubusercontent.com/bmrzzmrb/TapikTap/main/demaa.jpg'
        )">–í –ë–û–ô</button>
    </div>
    <div class="boss-card">
        <div class="boss-info">
            <b>–ë–ò–ì–ë–û–û–û–û–ù</b>
            <small>HP: 1 000 000</small>
            <small>–í—Ö–æ–¥: 100 000</small>
            <small>–ù–∞–≥—Ä–∞–¥–∞: 5 000 000</small>
            <small>–°–ª–∞–±–∞—è –≤–µ—Ä—Å–∏—è —Ç–æ–ª—Å—Ç–æ–≥–æ –ª—é–±–∏–º–æ–≥–æ –Ω–∞—à–µ–≥–æ –¥—Ä—É–≥–∞.</small>
        </div>
        <button class="neon-btn" onclick="startBossFight(
            '–ë–ò–ì–ë–û–û–û–û–ù',1000000,5000000,100000,
            'https://raw.githubusercontent.com/bmrzzmrb/TapikTap/main/bigbon.jpg'
        )">–í –ë–û–ô</button>
    </div>
    <div class="boss-card">
        <div class="boss-info">
            <b>–ë–ò–ì–ë–û–û–û–û–ù –í –ü–†–ê–ô–ú–ï</b>
            <small>HP: 100 000 000</small>
            <small>–í—Ö–æ–¥: 100 000</small>
            <small>–ù–∞–≥—Ä–∞–¥–∞: 50 000 000</small>
            <small>–û–ù –í –ü–†–ê–ô–ú–ï –ò –ö–£–®–ê–ï–¢ –ü–ï–ß–ï–ù–¨–ï,–í–ê–•–¢–ï–† –ü–†–û–ö–ê–ó–ù–ò–ö.</small>
        </div>
        <button class="neon-btn" onclick="startBossFight(
            '–ë–ò–ì–ë–û–û–û–û–ù –í –ü–†–ê–ô–ú–ï',100000000,50000000,100000,
            'https://raw.githubusercontent.com/bmrzzmrb/TapikTap/main/bigbontwo.jpg'
        )">–í –ë–û–ô</button>
    </div>
    <div class="boss-card">
        <div class="boss-info">
            <b>–ß–û–ü–û–†</b>
            <small>HP: 300 000 000</small>
            <small>–í—Ö–æ–¥: 50 000 000</small>
            <small>–ù–∞–≥—Ä–∞–¥–∞: 100 000 000</small>
            <small>11 –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ. –ú–Ø–Ø–Ø–Ø–Ø–ß –°–Æ–î–ê–ê–ê–ê–ê–ê.</small>
        </div>
        <button class="neon-btn" onclick="startBossFight(
            '–ß–û–ü–û–†',300000000,100000000,50000000,
            'https://raw.githubusercontent.com/bmrzzmrb/TapikTap/main/chopor.jpg'
        )">–í –ë–û–ô</button>
    </div>

</div>

<!-- –≠–ö–†–ê–ù –ë–û–Ø -->
<div id="boss-battle" class="screen">
    <h2 id="boss-name">–ë–û–°–°</h2>
    <div id="timer">‚è±Ô∏è 60</div>
    <div class="hp-container"><div id="hp-bar"></div></div>
    <img id="boss-img" onclick="hitBoss()">
</div>

<script>
let tg = window.Telegram.WebApp;
tg.expand();

// ===== –°–û–°–¢–û–Ø–ù–ò–ï –ò–ì–†–´ =====
let balance = 0;
let clickPower = 1;
let upgradeCost = 10;
let saveTimeout = null;
let upgradePriceStep = 10;
let x2UpgradeCost = 50000000;

// ===== –ê–ù–¢–ò-–ê–í–¢–û–ö–õ–ò–ö–ï–† =====
let clickTimestamps = [];
let clickBlockedUntil = 0;

const MAX_CLICKS_PER_SEC = 25;
const BLOCK_TIME_MS = 5 * 60 * 1000; // 5 –º–∏–Ω—É—Ç

// ===== –ë–û–°–° =====
let bossHp = 0;
let bossMaxHp = 0;
let bossReward = 0;
let fightTimer = null;
let timeLeft = 0;
let inBossFight = false;

function formatNumber(num) {
    return Math.floor(num).toLocaleString('de-DE');
}

// ===== –í–ò–ë–†–ê–¶–ò–Ø =====
function vibrate(type = 'light') {
    if (tg.HapticFeedback) {
        tg.HapticFeedback.impactOccurred(type);
    }
}

// ===== –ê–ó–ê–†–¢ =====
let currentBet = 0;

function setBet(amount) {
    currentBet = Math.min(amount, balance);
    updateGambleUI();
}

function setBetPercent(percent) {
    currentBet = Math.floor(balance * (percent / 100));
    updateGambleUI();
}

function setAllIn() {
    currentBet = balance;
    updateGambleUI();
}

function updateGambleUI() {
    document.getElementById('currentBet').innerText = formatNumber(currentBet);
}

function playGamble(color) {
    if (currentBet <= 0) {
        tg.showAlert('–°—Ç–∞–≤–∫–∞ –Ω–µ –≤—ã–±—Ä–∞–Ω–∞');
        return;
    }

    if (currentBet > balance) {
        tg.showAlert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —è–∏—Ü');
        return;
    }

    const colors = ['red', 'green', 'blue'];
    const result = colors[Math.floor(Math.random() * colors.length)];

    balance -= currentBet;

    let text = '–í—ã–ø–∞–ª —Ü–≤–µ—Ç: ';

    if (result === 'red') text += 'üî¥';
    if (result === 'green') text += 'üü¢';
    if (result === 'blue') text += 'üîµ';

    if (result === color) {
        const win = currentBet * 2;
        balance += win;
        text += '<br><b>üéâ –ü–æ–±–µ–¥–∞! +' + formatNumber(win) + '</b>';
    } else {
        text += '<br><b>‚ùå –ü—Ä–æ–∏–≥—Ä—ã—à</b>';
    }

    currentBet = 0;
    document.getElementById('gambleResult').innerHTML = text;

    updateUI();
    updateGambleUI();
    saveGame();
}

function isClickBlocked() {
    const now = Date.now();

    if (now < clickBlockedUntil) {
        const secondsLeft = Math.ceil((clickBlockedUntil - now) / 1000);
        tg.showAlert('‚õî –ü–ò–î–û–†–ê–° –û–ë–ù–ê–†–£–ñ–ï–ù\n–°–æ—Å–∏ —Ö—É–π ' + secondsLeft + ' —Å–µ–∫.');
        return true;
    }

    return false;
}

// –£–º–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ (–õ–æ–∫–∞–ª—å–Ω–æ + –û–±–ª–∞–∫–æ)
function saveGame() {
    const data = {
        balance: balance,
        clickPower: clickPower,
        upgradeCost: upgradeCost,
        x2UpgradeCost: x2UpgradeCost,
        clickBlockedUntil: clickBlockedUntil,
        lastSave: Date.now()
    };

    // 1. –°—Ä–∞–∑—É –≤ LocalStorage (–¥–ª—è –ü–ö)
    localStorage.setItem('eggGameSave', JSON.stringify(data));

    // 2. –í –û–±–ª–∞–∫–æ –¢–ì —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π (—á—Ç–æ–±—ã –Ω–µ –∑–∞–±–∞–Ω–∏–ª–∏ –∑–∞ —á–∞—Å—Ç—ã–µ –∑–∞–ø—Ä–æ—Å—ã)
    if (tg.isVersionAtLeast('6.9')) {
        clearTimeout(saveTimeout);
        saveTimeout = setTimeout(() => {
            tg.CloudStorage.setItem('gameData', JSON.stringify(data), (err) => {
                if (err) console.error("Cloud save error", err);
            });
        }, 1000); 
    }
}

// –ó–∞–≥—Ä—É–∑–∫–∞
function loadGame() {
    // –°–Ω–∞—á–∞–ª–∞ –∏–∑ –ø–∞–º—è—Ç–∏ –±—Ä–∞—É–∑–µ—Ä–∞
    const local = localStorage.getItem('eggGameSave');
    if (local) {
        const d = JSON.parse(local);
        balance = d.balance || 0;
        clickPower = d.clickPower || 1;
        upgradeCost = d.upgradeCost || 10;
        x2UpgradeCost = d.x2UpgradeCost || 50000000;
        clickBlockedUntil = d.clickBlockedUntil || 0;
        updateUI();
    }

    // –ü–æ—Ç–æ–º –∏–∑ –æ–±–ª–∞–∫–∞ –¢–ì (–µ—Å–ª–∏ —Ç–∞–º –¥–∞–Ω–Ω—ã–µ –Ω–æ–≤–µ–µ)
    if (tg.isVersionAtLeast('6.9')) {
        tg.CloudStorage.getItem('gameData', (err, value) => {
            if (!err && value) {
                const cloud = JSON.parse(value);
                const localData = local ? JSON.parse(local) : { lastSave: 0 };
                
                if (cloud.lastSave > localData.lastSave) {
                    balance = cloud.balance;
                    clickPower = cloud.clickPower;
                    upgradeCost = cloud.upgradeCost;
                    x2UpgradeCost = cloud.x2UpgradeCost;
                    clickBlockedUntil = d.clickBlockedUntil;
                    updateUI();
                }
            }
        });
    }
}

function updateUI() {
    document.getElementById('balance').innerText = formatNumber(balance);
    document.getElementById('clickLvl').innerText = formatNumber(clickPower);
    document.getElementById('upgradeCost').innerText = formatNumber(upgradeCost);

    if (document.getElementById('x2Cost')) {
        document.getElementById('x2Cost').innerText = formatNumber(x2UpgradeCost);
    }
}

function clickCoin() {
    const now = Date.now();

    // ‚õî –ï—Å–ª–∏ –∫–ª–∏–∫–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã
    if (isClickBlocked()) return;

    clickTimestamps = clickTimestamps.filter(t => now - t < 1000);
    clickTimestamps.push(now);

    // üö® –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä–∞
    if (clickTimestamps.length > MAX_CLICKS_PER_SEC) {
        clickBlockedUntil = now + BLOCK_TIME_MS;
        clickTimestamps = [];

        tg.showAlert('üö® –û–±–Ω–∞—Ä—É–∂–µ–Ω –ø–∏–¥–æ—Ä–∞—Å —Å –∫–ª–∏–∫–µ—Ä–æ–º!\n–ö–ª–∏–∫–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ 5 –º–∏–Ω—É—Ç.');
        saveGame();
        return;
    }

    // ‚úÖ –û–±—ã—á–Ω—ã–π –∫–ª–∏–∫
    balance += clickPower;
    vibrate('light');
    updateUI();
    saveGame();

    const img = document.getElementById('coin');
    img.style.transform = 'scale(0.95)';
    setTimeout(() => img.style.transform = 'scale(1)', 50);
}

function upgradeClick() {
    if (balance >= upgradeCost) {
        balance -= upgradeCost;
        clickPower += 1; 
        upgradeCost = upgradeCost + upgradePriceStep;
        vibrate('medium');
        updateUI();
        saveGame();
    } else {
        tg.showAlert('–ú–∞–ª–æ —è–∏—Ü!');
    }
}
function upgradeClickX2() {
    if (balance >= x2UpgradeCost) {
        balance -= x2UpgradeCost;
        clickPower *= 2;
        x2UpgradeCost *= 5;
        vibrate('heavy');
        updateUI();
        saveGame();
    } else {
        tg.showAlert('–ù—É–∂–Ω–æ ' + x2UpgradeCost + ' —è–∏—Ü!');
    }
}
// ===== –°–¢–ê–†–¢ –ë–û–°–°–ê =====
function startBossFight(name, hp, reward, cost, img) {
    if (balance < cost) {
        tg.showAlert('–ù—É–∂–Ω–æ ' + cost + ' —è–∏—Ü!');
        return;
    }

    balance -= cost;
    updateUI();

    bossHp = hp;
    bossMaxHp = hp;
    bossReward = reward;
    timeLeft = 60;
    inBossFight = true;

    document.getElementById('boss-name').innerText = name;
    document.getElementById('boss-img').src = img;
    document.getElementById('hp-bar').style.width = '100%';
    document.getElementById('timer').innerText = '‚è±Ô∏è 60';

    showScreen('boss-battle');

    clearInterval(fightTimer);
    fightTimer = setInterval(() => {
        timeLeft--;
        document.getElementById('timer').innerText = '‚è±Ô∏è ' + timeLeft;

        if (timeLeft <= 0) {
            endBossFight(false, '‚è±Ô∏è –í—Ä–µ–º—è –≤—ã—à–ª–æ! –¢—ã –¥–æ–ª–±–∞–µ–±');
        }
    }, 1000);
}

// ===== –£–î–ê–† –ü–û –ë–û–°–°–£ =====
function hitBoss() {
    if (!inBossFight) return;

    // –£–†–û–ù
    bossHp -= clickPower;
    if (bossHp < 0) bossHp = 0;

    // üîÆ 5% –õ–ï–ß–ï–ù–ò–ï
    if (Math.random() < 0.05 && bossHp > 0) {
        const heal = Math.floor(bossMaxHp * 0.1);
        bossHp = Math.min(bossHp + heal, bossMaxHp);
        tg.showAlert('–ë–æ—Å—Å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª HP! –û–ù –Æ–ó–ê–ï–¢ –ó–ê–ù–´');
    }

    // üí∞ 15% –ö–†–ê–ñ–ê
    if (Math.random() < 0.02 && balance > 0) {
        const stolen = Math.max(1, Math.floor(balance * 0.05));
        balance = Math.max(0, balance - stolen);
        tg.showAlert('–ë–æ—Å—Å —Å–ø–∏–∑–¥–∏–ª ' + stolen + ' —è–∏—Ü!');
        updateUI();
    }

    vibrate('light');

    document.getElementById('hp-bar').style.width =
        (bossHp / bossMaxHp * 100) + '%';

    if (bossHp <= 0) {
        endBossFight(true, '–ü–æ–±–µ–¥–∞! +' + bossReward);
    }
}

// ===== –ö–û–ù–ï–¶ –ë–û–Ø =====
function endBossFight(win, message) {
    clearInterval(fightTimer);
    inBossFight = false;

    if (win) {
        balance += bossReward;
        saveGame();
    }

    tg.showAlert(message);
    showScreen('main');
    updateUI();
}

// ===== –≠–ö–†–ê–ù–´ =====
function showScreen(id, btn) {
    document.querySelectorAll('.screen').forEach(s =>
        s.classList.remove('active-screen')
    );
    document.getElementById(id).classList.add('active-screen');

    if (btn) {
        document.querySelectorAll('.tab-btn').forEach(b =>
            b.classList.remove('active')
        );
        btn.classList.add('active');
    }
}

// –°—Ç–∞—Ä—Ç
loadGame();
</script>
</body>
</html>
